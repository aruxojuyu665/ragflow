---
sidebar_position: 0
slug: /
---

# Начало работы
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import APITable from '@site/src/components/APITable';

RAGFlow — это open-source движок RAG (Retrieval-Augmented Generation, генерация с использованием поиска), основанный на глубоком понимании документов. При интеграции с LLM он способен предоставлять достоверные ответы на вопросы, подкреплённые обоснованными ссылками из различных данных со сложным форматированием.

Это руководство быстрого старта описывает общий процесс от:

- Запуска локального сервера RAGFlow,
- Создания набора данных,
- Вмешательства в разбор файлов,
- До организации AI-чата на основе ваших наборов данных.

:::danger IMPORTANT
Мы официально поддерживаем x86 CPU и Nvidia GPU, и в этом документе приведены инструкции по развертыванию RAGFlow с использованием Docker на платформах x86. Хотя мы также тестируем RAGFlow на платформах ARM64, мы не поддерживаем Docker-образы RAGFlow для ARM.

Если вы используете платформу ARM, следуйте [этому руководству](./develop/build_docker_image.mdx) для сборки Docker-образа RAGFlow.
:::

## Требования

- CPU &ge; 4 ядра (x86);
- ОЗУ &ge; 16 ГБ;
- Диск &ge; 50 ГБ;
- Docker &ge; 24.0.0 и Docker Compose &ge; v2.26.1.
- [gVisor](https://gvisor.dev/docs/user_guide/install/): требуется только если вы планируете использовать функцию исполнения кода ([sandbox](https://github.com/infiniflow/ragflow/tree/main/sandbox)) в RAGFlow.

:::tip NOTE
Если Docker не установлен на вашем локальном компьютере (Windows, Mac или Linux), смотрите [Установка Docker Engine](https://docs.docker.com/engine/install/).
:::

## Запуск сервера

В этом разделе приведены инструкции по настройке сервера RAGFlow на Linux. Если вы используете другую операционную систему, не переживайте — большинство шагов схожи.

<details>
  <summary>1. Убедитесь, что <code>vm.max_map_count</code> &ge; 262144:</summary>

   `vm.max_map_count` — это значение, задающее максимальное количество областей отображения памяти, которые может иметь процесс. Значение по умолчанию — 65530. Хотя большинству приложений требуется меньше тысячи таких областей, уменьшение этого значения может привести к аномальному поведению, и система будет выдавать ошибки нехватки памяти, когда процесс достигнет лимита.

   RAGFlow v0.21.1 использует Elasticsearch или [Infinity](https://github.com/infiniflow/infinity) для множественного поиска. Правильная настройка `vm.max_map_count` критична для корректной работы компонента Elasticsearch.

<Tabs
  defaultValue="linux"
  values={[
    {label: 'Linux', value: 'linux'},
    {label: 'macOS', value: 'macos'},
    {label: 'Windows', value: 'windows'},
  ]}>
  <TabItem value="linux">
   1.1. Проверьте значение `vm.max_map_count`:

   ```bash
   $ sysctl vm.max_map_count
   ```

   1.2. Установите `vm.max_map_count` в значение не менее 262144, если оно меньше.

   ```bash
   $ sudo sysctl -w vm.max_map_count=262144
   ```

   :::caution WARNING
   Это изменение сбросится после перезагрузки системы. Если вы забудете обновить значение при следующем запуске сервера, может возникнуть исключение `Can't connect to ES cluster`.
   :::
   
   1.3. Чтобы изменение было постоянным, добавьте или обновите значение `vm.max_map_count` в файле **/etc/sysctl.conf** следующим образом:

   ```bash
   vm.max_map_count=262144
   ```
  </TabItem>
  <TabItem value="macos">
   Если вы используете macOS с Docker Desktop, выполните следующую команду для обновления `vm.max_map_count`:

   ```bash
   docker run --rm --privileged --pid=host alpine sysctl -w vm.max_map_count=262144
   ```

   :::caution WARNING
   Это изменение сбросится после перезагрузки системы. Если вы забудете обновить значение при следующем запуске сервера, может возникнуть исключение `Can't connect to ES cluster`.
   :::

   Чтобы сделать изменение постоянным, создайте файл с соответствующими настройками:

   1.1. Создайте файл:

   ```shell
   sudo nano /Library/LaunchDaemons/com.user.vmmaxmap.plist
   ```

   1.2. Откройте файл:

   ```shell
   sudo launchctl load /Library/LaunchDaemons/com.user.vmmaxmap.plist
   ```

   1.3. Добавьте настройки:

   ```xml
   <?xml version="1.0" encoding="UTF-8"?>
   <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
   <plist version="1.0">
   <dict>
       <key>Label</key>
       <string>com.user.vmmaxmap</string>
       <key>ProgramArguments</key>
       <array>
           <string>/usr/sbin/sysctl</string>
           <string>-w</string>
           <string>vm.max_map_count=262144</string>
       </array>
       <key>RunAtLoad</key>
       <true/>
   </dict>
   </plist>
   ```

   1.4. После сохранения файла загрузите новый демон:

   ```shell
   sudo launchctl load /Library/LaunchDaemons/com.user.vmmaxmap.plist
   ```

   :::note
   Если описанные шаги не работают, рассмотрите возможность использования [этого обходного решения](https://github.com/docker/for-mac/issues/7047#issuecomment-1791912053), которое использует контейнер и не требует ручного редактирования настроек macOS.
   :::

  </TabItem>
  <TabItem value="windows">

   #### Если вы используете Windows с Docker Desktop, *обязательно* используйте docker-machine для установки `vm.max_map_count`:

   ```bash
   $ docker-machine ssh
   $ sudo sysctl -w vm.max_map_count=262144
   ```
   #### Если вы используете Windows с Docker Desktop и бэкендом WSL 2, используйте docker-desktop для установки `vm.max_map_count`:

   1.1. Выполните в WSL: 
   ```bash
   $ wsl -d docker-desktop -u root
   $ sysctl -w vm.max_map_count=262144
   ```

   :::caution WARNING
   Это изменение сбросится после перезапуска Docker. Если вы забудете обновить значение при следующем запуске сервера, может возникнуть исключение `Can't connect to ES cluster`.
   :::

   1.2. Если вы не хотите выполнять эти команды после каждого перезапуска Docker, вы можете обновить файл `%USERPROFILE%.wslconfig` следующим образом, чтобы сохранить изменение постоянным и глобальным для всех WSL-дистрибутивов:

   ```bash
   [wsl2]
   kernelCommandLine = "sysctl.vm.max_map_count=262144"
   ```
   *Это заставит все виртуальные машины WSL2 применять эту настройку при запуске.*

   :::note
   Если вы используете Windows 11 или Windows 10 версии 22H2 и установили WSL из Microsoft Store, вы также можете обновить **/etc/sysctl.conf** внутри WSL-дистрибутива docker-desktop для сохранения изменения:

   ```bash
   $ wsl -d docker-desktop -u root
   $ vi /etc/sysctl.conf
   ```

   ```bash
   # Добавьте строку:
   vm.max_map_count = 262144
   ```
   :::
  </TabItem>
</Tabs>

</details>

2. Клонируйте репозиторий:

   ```bash
   $ git clone https://github.com/infiniflow/ragflow.git
   $ cd ragflow/docker
   $ git checkout -f v0.21.1
   ```

3. Используйте предварительно собранные Docker-образы и запустите сервер:

   :::tip NOTE
   Команда ниже скачивает Docker-образ RAGFlow версии `v0.21.1-slim`. Ознакомьтесь с таблицей ниже для описания различных редакций RAGFlow. Чтобы скачать редакцию, отличную от `v0.21.1-slim`, обновите переменную `RAGFLOW_IMAGE` в файле **docker/.env** перед запуском сервера через `docker compose`. Например: установите `RAGFLOW_IMAGE=infiniflow/ragflow:v0.21.1` для полной редакции `v0.21.1`.
   :::

   ```bash
   # Использовать CPU для embedding и DeepDoc задач:
   $ docker compose -f docker-compose.yml up -d
   ```

```mdx-code-block
<APITable>
```

| Тег образа RAGFlow | Размер образа (ГБ) | Содержит модели embedding и Python-пакеты? | Стабильность             |
| ------------------- | ----------------- | ----------------------------------------- | ----------------------- |
| v0.21.1             | &approx;9         | ✔️                                        | Стабильный релиз        |
| v0.21.1-slim        | &approx;2         | ❌                                        | Стабильный релиз        |
| nightly             | &approx;2         | ❌                                        | _Нестабильная_ ночная сборка |

```mdx-code-block
</APITable>
```

:::danger IMPORTANT
Включённые в образы `v0.21.1` и `nightly` embedding модели:

- BAAI/bge-large-zh-v1.5
- maidalun1020/bce-embedding-base_v1

Эти две embedding модели оптимизированы специально для английского и китайского языков, поэтому производительность будет снижена при использовании для встраивания документов на других языках.
:::

:::tip NOTE
Размер образа указан для *скачанного* Docker-образа, который сжат. При запуске Docker распаковывает образ, что приводит к значительно большему использованию дискового пространства. Например, образ slim-редакции развернётся примерно до 7 ГБ.
:::

4. Проверьте статус сервера после запуска:

   ```bash
   $ docker logs -f docker-ragflow-cpu-1
   ```

   _Следующий вывод подтверждает успешный запуск системы:_

   ```bash
        ____   ___    ______ ______ __
       / __ \ /   |  / ____// ____// /____  _      __
      / /_/ // /| | / / __ / /_   / // __ \| | /| / /
     / _, _// ___ |/ /_/ // __/  / // /_/ /| |/ |/ /
    /_/ |_|/_/  |_|\____//_/    /_/ \____/ |__/|__/
   
    * Running on all addresses (0.0.0.0)
   ```

:::danger IMPORTANT
Если пропустить этот шаг подтверждения и сразу войти в RAGFlow, браузер может выдать ошибку `network anomaly`, так как в этот момент RAGFlow может быть ещё не полностью инициализирован.
:::  

5. В вашем веб-браузере введите IP-адрес вашего сервера и войдите в RAGFlow.

:::caution WARNING
При настройках по умолчанию достаточно ввести `http://IP_ВАШЕЙ_МАШИНЫ` (**без** номера порта), так как стандартный HTTP-порт `80` можно опустить при использовании конфигураций по умолчанию.
:::

## Настройка LLM

RAGFlow — это движок RAG и требует работы с LLM для предоставления обоснованных, без галлюцинаций ответов на вопросы. RAGFlow поддерживает большинство популярных LLM. Полный список поддерживаемых моделей смотрите в разделе [Supported Models](./references/supported_models.mdx).

:::note 
RAGFlow также поддерживает локальное развертывание LLM с помощью Ollama, Xinference или LocalAI, но этот раздел не рассматривается в данном руководстве быстрого старта.
:::

Чтобы добавить и настроить LLM:

1. Нажмите на логотип в правом верхнем углу страницы **>** **Model providers**.

2. Выберите нужный LLM и обновите API-ключ.

3. Нажмите **System Model Settings** для выбора моделей по умолчанию:

   - Chat model,
   - Embedding model,
   - Image-to-text model,
   - и другие.

> Некоторые модели, например, модель преобразования изображения в текст **qwen-vl-max**, являются вспомогательными для конкретного LLM. Для доступа к ним может потребоваться обновление API-ключа.

## Создание первого набора данных

В RAGFlow вы можете загружать файлы в набор данных и парсить их. Набор данных — это виртуальная коллекция наборов данных. Ответы на вопросы в RAGFlow могут основываться на одном или нескольких наборах данных. Поддерживаемые форматы файлов включают документы (PDF, DOC, DOCX, TXT, MD, MDX), таблицы (CSV, XLSX, XLS), изображения (JPEG, JPG, PNG, TIF, GIF) и презентации (PPT, PPTX).

Чтобы создать первый набор данных:

1. Нажмите вкладку **Dataset** в верхней средней части страницы **>** **Create dataset**.

2. Введите имя набора данных и нажмите **OK** для подтверждения.

   _Вы перейдёте на страницу **Configuration** вашего набора данных._

   ![конфигурация набора данных](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/configure_knowledge_base.jpg)

3. RAGFlow предлагает несколько шаблонов для разбиения на чанки, учитывающих разные макеты документов и форматы файлов. Выберите embedding модель и метод разбиения (шаблон) для вашего набора данных.

:::danger IMPORTANT 
После выбора embedding модели и использования её для парсинга файла, изменить модель уже нельзя. Это необходимо, чтобы все файлы в конкретном наборе данных были обработаны *одной* embedding моделью (для обеспечения сравнимости в одном embedding пространстве).
:::

   _Вы перейдёте на страницу **Dataset** вашего набора данных._

4. Нажмите **+ Add file** **>** **Local files** для загрузки файла в набор данных.

5. В записи загруженного файла нажмите кнопку воспроизведения, чтобы начать парсинг файла:

   ![парсинг файла](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/parse_file.jpg)

:::caution NOTE 
- Если парсинг файла застрял на отметке ниже 1%, смотрите [этот FAQ](./faq.mdx#why-does-my-document-parsing-stall-at-under-one-percent).
- Если парсинг файла застрял почти у завершения, смотрите [этот FAQ](./faq.mdx#why-does-my-pdf-parsing-stall-near-completion-while-the-log-does-not-show-any-error)
:::

## Вмешательство в парсинг файлов

RAGFlow обеспечивает видимость и объяснимость, позволяя просматривать результаты разбиения на чанки и при необходимости вмешиваться. Для этого:

1. Нажмите на файл, завершивший парсинг, чтобы просмотреть результаты разбиения:

   _Вы перейдёте на страницу **Chunk**:_

   ![чанки](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/file_chunks.jpg)

2. Наведите курсор на каждый снимок для быстрого просмотра чанка.

3. Дважды кликните по текстам чанков, чтобы добавить ключевые слова или внести *ручные* изменения при необходимости:

   ![обновление чанка](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/add_keyword_question.jpg)

:::caution NOTE
Вы можете добавить ключевые слова или вопросы к чанку файла, чтобы улучшить его рейтинг для запросов, содержащих эти ключевые слова. Это увеличивает вес ключевых слов и может повысить позицию в списке поиска.
:::

4. В разделе Retrieval testing задайте быстрый вопрос в поле **Test text**, чтобы проверить, работают ли ваши настройки:

   _Как видно ниже, RAGFlow отвечает с достоверными ссылками._

   ![тест поиска](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/retrieval_test.jpg)

## Настройка AI-чата

Диалоги в RAGFlow основаны на одном или нескольких наборах данных. После создания набора данных и завершения парсинга файлов вы можете начать AI-разговор.

1. Нажмите вкладку **Chat** в верхней средней части страницы **>** **Create chat** для создания чат-ассистента.
2. Нажмите на созданное чат-приложение, чтобы перейти на страницу его конфигурации.
   > RAGFlow предоставляет гибкость выбора разных моделей чата для каждого диалога, при этом позволяя задать модели по умолчанию в **System Model Settings**.

2. Обновите **Chat setting** справа на странице конфигурации:

   - Назовите вашего ассистента и укажите наборы данных.
   - **Empty response**:
     - Если вы хотите *ограничить* ответы RAGFlow вашими наборами данных, укажите здесь ответ. Тогда при отсутствии найденного ответа RAGFlow будет *одинаково* отвечать тем, что вы здесь задали.
     - Если вы хотите, чтобы RAGFlow *импровизировал*, когда не находит ответ в наборах данных, оставьте поле пустым, что может привести к галлюцинациям.

3. Обновите **System prompt** или оставьте как есть для начала.

4. Выберите модель чата в выпадающем списке **Model**.

5. Теперь можно начинать:

   ![чат_термальное_решение](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/chat_thermal_solution.jpg)


:::tip NOTE
RAGFlow также предлагает HTTP и Python API для интеграции возможностей RAGFlow в ваши приложения. Подробнее в следующих документах:

- [Получение API ключа RAGFlow](./develop/acquire_ragflow_api_key.md)
- [Справочник HTTP API](./references/http_api_reference.md)
- [Справочник Python API](./references/python_api_reference.md)
:::