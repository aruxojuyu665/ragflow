---
sidebar_position: 20
slug: /sandbox_quickstart
---

# Быстрый старт с Sandbox

Безопасный, подключаемый бэкенд для выполнения кода, разработанный для RAGFlow и других приложений, требующих изолированных сред выполнения кода.

## Особенности:

- Бесшовная интеграция с RAGFlow — Работает из коробки с компонентом кода RAGFlow.
- Высокая безопасность — Использует gVisor для песочницы (sandboxing) на уровне системных вызовов (syscall) для изоляции выполнения.
- Настраиваемая песочница — Легко модифицируйте seccomp-профили для адаптации ограничений системных вызовов.
- Поддержка подключаемых рантаймов — Расширяемая поддержка любых сред выполнения языков программирования.
- Удобство для разработчиков — Быстрая настройка с удобным Makefile.

## Архитектура

Архитектура состоит из изолированных базовых Docker-образов для каждого поддерживаемого рантайма языка, управляемых сервисом executor manager. Executor manager оркестрирует выполнение кода в песочнице с использованием gVisor для перехвата системных вызовов и опциональных seccomp-профилей для улучшенной фильтрации системных вызовов.

## Требования

- Дистрибутив Linux, совместимый с gVisor.
- Установленный и настроенный gVisor.
- Docker версии 24.0.0 или выше.
- Docker Compose версии 2.26.1 или выше (аналогично требованиям RAGFlow).
- Установленные uv пакет и менеджер проектов.
- (Опционально) GNU Make для упрощённого управления из командной строки.

## Сборка базовых Docker-образов

Песочница использует изолированные базовые образы для безопасных контейнеризированных сред выполнения.

Соберите базовые образы вручную:

```bash
docker build -t sandbox-base-python:latest ./sandbox_base_image/python
docker build -t sandbox-base-nodejs:latest ./sandbox_base_image/nodejs
```

Или соберите все базовые образы сразу с помощью Makefile:

```bash
make build
```

Далее соберите образ executor manager:

```bash
docker build -t sandbox-executor-manager:latest ./executor_manager
```

## Запуск с RAGFlow

1. Убедитесь, что gVisor установлен и работает корректно.

2. Настройте файл .env, расположенный в docker/.env:

- Раскомментируйте переменные окружения, связанные с песочницей.
- Включите профиль песочницы внизу файла.

3. Добавьте следующую запись в файл /etc/hosts для разрешения сервиса executor manager:

```bash
127.0.0.1 es01 infinity mysql minio redis sandbox-executor-manager
```

4. Запустите сервис RAGFlow как обычно.

## Запуск автономно

### Ручная настройка

1. Инициализируйте переменные окружения:

```bash
cp .env.example .env
```

2. Запустите сервисы песочницы с помощью Docker Compose:

```bash
docker compose -f docker-compose.yml up
```

3. Проверьте настройку песочницы:

```bash
source .venv/bin/activate
export PYTHONPATH=$(pwd)
uv pip install -r executor_manager/requirements.txt
uv run tests/sandbox_security_tests_full.py
```

### Использование Makefile

Выполните всю настройку, сборку, запуск и тесты одной командой:

```bash
make
```

### Мониторинг

Чтобы просмотреть логи контейнера executor manager:

```bash
docker logs -f sandbox-executor-manager
```

Или используйте сокращение через Makefile:

```bash
make logs
```