---
sidebar_position: 3
slug: /retrieval_component
---

# Компонент Retrieval (Извлечение)

Компонент, который извлекает информацию из указанных наборов данных.

## Сценарии

Компонент **Retrieval** необходим в большинстве сценариев RAG, где информация извлекается из назначенных наборов данных перед передачей в LLM для генерации контента. Компонент **Retrieval** может работать как самостоятельный модуль рабочего процесса или как инструмент для компонента **Agent**. В последнем случае компонент **Agent** самостоятельно контролирует, когда вызывать его для запроса и извлечения данных.

На следующем скриншоте показан эталонный дизайн с использованием компонента **Retrieval**, где компонент служит инструментом для компонента **Agent**. Его можно найти в шаблоне агента **Report Agent Using Knowledge Base**.

![retrieval_reference_design](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/retrieval_reference_design.jpg)

_Эталонный дизайн компонента Retrieval_

## Предварительные требования

Убедитесь, что вы [правильно настроили целевой набор данных(ы)](../../dataset/configure_knowledge_base.md).

## Быстрый старт

### 1. Нажмите на компонент **Retrieval**, чтобы открыть панель конфигурации  

Соответствующая панель конфигурации появится справа от холста. Используйте эту панель для определения и тонкой настройки поведения поиска компонента **Retrieval**.

### 2. Введите переменную(ые) запроса

Компонент **Retrieval** зависит от переменных запроса для задания своих запросов.

:::caution IMPORTANT
- Если вы используете компонент **Retrieval** как самостоятельный модуль рабочего процесса, вводите переменные запроса в текстовое поле **Input Variables**.
- Если он используется как инструмент для компонента **Agent**, вводите переменные запроса в поле **User prompt** компонента **Agent**.
:::

По умолчанию можно использовать `sys.query`, который является пользовательским запросом и стандартным выводом компонента **Begin**. Все глобальные переменные, определённые до компонента **Retrieval**, также могут использоваться в качестве запросов. Используйте кнопку `(x)` или введите `/`, чтобы показать все доступные переменные запроса.

### 3. Выберите набор(ы) данных для запроса

Вы можете указать один или несколько наборов данных для извлечения информации. При выборе нескольких наборов данных убедитесь, что они используют одну и ту же модель встраивания (embedding model).

### 4. Разверните **Advanced Settings** для настройки метода извлечения

По умолчанию для извлечения используется комбинация взвешенного сходства по ключевым словам и взвешенного косинусного сходства векторов. Если выбран rerank-модель, будет использоваться комбинация взвешенного сходства по ключевым словам и взвешенного reranking-скорa.

Для начала вы можете пропустить этот шаг и использовать метод извлечения по умолчанию.

:::caution WARNING
Использование rerank-модели *значительно* увеличит время отклика системы.
:::

### 5. Включите кросс-языковой поиск

Если язык пользовательского запроса отличается от языков наборов данных, вы можете выбрать целевые языки в выпадающем меню **Cross-language search**. Модель затем переведёт запросы для обеспечения точного сопоставления семантического значения между языками.

### 6. Проверьте результаты извлечения

Нажмите кнопку **Run** в верхней части холста, чтобы протестировать результаты извлечения.

### 7. Выберите следующий компонент

При необходимости нажмите кнопку **+** на компоненте **Retrieval**, чтобы выбрать следующий компонент рабочего процесса из выпадающего списка.

## Конфигурации

### Переменные запроса

*Обязательно*

Выберите источник запроса для извлечения. По умолчанию — `sys.query`, который является стандартным выводом компонента **Begin**.

Компонент **Retrieval** опирается на переменные запроса для задания своих запросов. Все глобальные переменные, определённые до компонента **Retrieval**, также могут использоваться в качестве запросов. Используйте кнопку `(x)` или введите `/`, чтобы показать все доступные переменные запроса.

### Базы знаний (Knowledge bases)

Выберите набор(ы) данных для извлечения информации.

- Если набор данных не выбран, то разговоры с агентом не будут основаны на каком-либо наборе данных, при этом поле **Empty response** должно оставаться пустым, чтобы избежать ошибки.
- Если выбрано несколько наборов данных, необходимо убедиться, что все выбранные наборы используют одну и ту же модель встраивания; в противном случае возникнет сообщение об ошибке.

### Порог сходства (Similarity threshold)

RAGFlow использует комбинацию взвешенного сходства по ключевым словам и взвешенного косинусного сходства векторов при извлечении. Этот параметр задаёт порог для сходства между пользовательским запросом и фрагментами, хранящимися в наборах данных. Любой фрагмент с оценкой сходства ниже этого порога будет исключён из результатов.

По умолчанию — 0.2.

### Вес векторного сходства (Vector similarity weight)

Этот параметр задаёт вес векторного сходства в комбинированной оценке сходства. Сумма двух весов должна равняться 1.0. Значение по умолчанию — 0.3, что означает, что вес сходства по ключевым словам в комбинированном поиске равен 1 - 0.3 = 0.7.

### Top N

Этот параметр выбирает "Top N" фрагментов из извлечённых и передаёт их в LLM.

По умолчанию — 8.

### Модель rerank (Rerank model)

*Опционально*

Если выбрана rerank-модель, для извлечения будет использоваться комбинация взвешенного сходства по ключевым словам и взвешенного reranking-скорa.

:::caution WARNING
Использование rerank-модели *значительно* увеличит время отклика системы.
:::

### Пустой ответ (Empty response)

- Установите это значение в качестве ответа, если по вашему запросу не найдено результатов в наборе(ах) данных, или
- Оставьте поле пустым, чтобы чат-модель могла импровизировать, когда ничего не найдено.

:::caution WARNING
Если вы не указали набор данных, это поле должно оставаться пустым; в противном случае возникнет ошибка.
:::

### Кросс-языковой поиск (Cross-language search)

Выберите один или несколько языков для кросс-языкового поиска. Если язык не выбран, система будет искать по исходному запросу.

### Использовать граф знаний (Use knowledge graph)

:::caution IMPORTANT
Перед включением этой функции убедитесь, что вы правильно [построили граф знаний из каждого целевого набора данных](../../dataset/construct_knowledge_graph.md).
:::

Опция использования графа знаний в указанных наборах данных при извлечении для многошагового ответа на вопросы. При включении происходит итеративный поиск по сущностям, отношениям и фрагментам отчётов сообщества, что значительно увеличивает время извлечения.

### Вывод (Output)

Имя глобальной переменной для вывода компонента **Retrieval**, которая может быть использована другими компонентами в рабочем процессе.

## Часто задаваемые вопросы

### Как сократить время отклика?

Пройдитесь по следующему чек-листу для оптимальной производительности:

- Оставьте поле **Rerank model** пустым, чтобы отключить rerank.
- Отключите **Use knowledge graph**.