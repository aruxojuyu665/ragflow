---
sidebar_position: 8
slug: /construct_knowledge_graph
---

# Построение knowledge graph (графа знаний)

Генерация knowledge graph для вашего набора данных.

---

Для улучшения многошагового вопросно-ответного взаимодействия RAGFlow добавляет этап построения knowledge graph между извлечением данных и индексированием, как показано ниже. Этот этап создает дополнительные чанки на основе существующих, сгенерированных вашим выбранным методом разбиения.

![Изображение](https://github.com/user-attachments/assets/1ec21d8e-f255-4d65-9918-69b72dfa142b)

Начиная с версии v0.16.0, RAGFlow поддерживает построение knowledge graph на наборе данных, позволяя создавать *единый* граф, охватывающий несколько файлов внутри вашего набора данных. При загрузке нового файла и начале его парсинга сгенерированный граф будет автоматически обновляться.

:::danger WARNING
Построение knowledge graph требует значительных ресурсов памяти, вычислительных мощностей и токенов.
:::

## Сценарии

Knowledge graph особенно полезны для многошагового вопросно-ответного взаимодействия с *вложенной* логикой. Они превосходят традиционные методы извлечения при работе с вопросами по книгам или произведениям с комплексными сущностями и взаимосвязями.

:::tip NOTE
RAPTOR (Recursive Abstractive Processing for Tree Organized Retrieval) также может использоваться для задач многошагового вопросно-ответного взаимодействия. Подробнее см. в разделе [Включение RAPTOR](./enable_raptor.md). Вы можете использовать любой из подходов или оба, но убедитесь, что понимаете затраты по памяти, вычислениям и токенам.
:::

## Предварительные требования

Для генерации knowledge graph используется системная модель чата по умолчанию. Перед началом убедитесь, что у вас корректно настроена модель чата:

![Настройка моделей по умолчанию](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/set_default_models.jpg)

## Конфигурации

### Типы сущностей (*Обязательно*)

Типы сущностей, которые необходимо извлечь из вашего набора данных. Типы по умолчанию: **organization** (организация), **person** (персона), **event** (событие) и **category** (категория). Добавляйте или удаляйте типы в соответствии с вашим конкретным набором данных.

### Метод

Метод, используемый для построения knowledge graph:

- **General**: Использует подсказки от [GraphRAG](https://github.com/microsoft/graphrag) для извлечения сущностей и взаимосвязей.
- **Light**: (По умолчанию) Использует подсказки от [LightRAG](https://github.com/HKUDS/LightRAG) для извлечения сущностей и взаимосвязей. Этот вариант потребляет меньше токенов, памяти и вычислительных ресурсов.

### Разрешение сущностей

Включить или отключить разрешение сущностей. Это можно рассматривать как переключатель дедупликации сущностей. При включении LLM объединит похожие сущности — например, '2025' и 'год 2025', или 'IT' и 'Information Technology' — для построения более эффективного графа.

- (По умолчанию) Разрешение сущностей отключено.
- Включить разрешение сущностей. Этот вариант потребляет больше токенов.

### Отчёты по сообществам

В knowledge graph сообщество — это кластер сущностей, связанных взаимосвязями. Вы можете заставить LLM сгенерировать аннотацию для каждого сообщества, известную как отчёт по сообществу. Подробнее см. [здесь](https://www.microsoft.com/en-us/research/blog/graphrag-improving-global-search-via-dynamic-community-selection/). Этот параметр указывает, генерировать ли отчёты по сообществам:

- Генерировать отчёты по сообществам. Этот вариант потребляет больше токенов.
- (По умолчанию) Не генерировать отчёты по сообществам.

## Быстрый старт

1. Перейдите на страницу **Configuration** вашего набора данных и обновите:
   
   - Типы сущностей: *Обязательно* — задаёт типы сущностей для генерации knowledge graph. Вы не обязаны использовать значения по умолчанию, но должны настроить их под ваши документы.
   - Метод: *Необязательно*
   - Разрешение сущностей: *Необязательно*
   - Отчёты по сообществам: *Необязательно*
   *Конфигурации knowledge graph для вашего набора данных установлены.*

2. Перейдите на страницу **Files** вашего набора данных, нажмите кнопку **Generate** в правом верхнем углу, затем выберите **Knowledge graph** из выпадающего меню для запуска процесса генерации knowledge graph.

   *Вы можете нажать кнопку паузы в выпадающем меню, чтобы при необходимости приостановить процесс сборки.*

3. Вернитесь на страницу **Configuration**:  
   
   *После генерации knowledge graph поле **Knowledge graph** изменится с `Not generated` на `Generated at a specific timestamp`. Вы можете удалить граф, нажав кнопку корзины справа от поля.*

4. Чтобы использовать созданный knowledge graph, выполните одно из следующих действий:
   
   - В панели **Chat setting** вашего чат-приложения включите переключатель **Use knowledge graph**.
   - Если вы используете агент, нажмите на компонент агента **Retrieval**, чтобы указать набор(ы) данных и включить переключатель **Use knowledge graph**.

## Часто задаваемые вопросы

### Обновляется ли knowledge graph автоматически при удалении связанного файла?

Нет. Knowledge graph *не обновляется*, *пока* вы не сгенерируете его заново для вашего набора данных.

### Как удалить сгенерированный knowledge graph?

На странице **Configuration** вашего набора данных найдите поле **Knowledge graph** и нажмите кнопку корзины справа от поля.

### Где хранится созданный knowledge graph?

Все чанки созданного knowledge graph хранятся в документ-движке RAGFlow: либо Elasticsearch, либо [Infinity](https://github.com/infiniflow/infinity).

### Как экспортировать созданный knowledge graph?

Экспорт созданного knowledge graph не поддерживается. Если вы считаете эту функцию важной, пожалуйста, [создайте issue](https://github.com/infiniflow/ragflow/issues), описав ваш кейс и его значимость.