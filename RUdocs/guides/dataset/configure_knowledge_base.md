---
sidebar_position: -10
slug: /configure_knowledge_base
---

# Настройка набора данных

Большинство чат-ассистентов и агентов RAGFlow основаны на наборах данных. Каждый набор данных RAGFlow служит источником знаний, *парся* файлы, загруженные с вашего локального компьютера, и ссылки на файлы, созданные в **File Management (Управление файлами)**, преобразуя их в реальные «знания» для будущих AI-чатов. В этом руководстве показаны базовые способы использования функции набора данных, охватывающие следующие темы:

- Создание набора данных
- Настройка набора данных
- Поиск набора данных
- Удаление набора данных

## Создание набора данных

С несколькими наборами данных вы можете создавать более гибкие и разнообразные ответы на вопросы. Чтобы создать первый набор данных:

![create dataset](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/create_knowledge_base.jpg)

_Каждый раз при создании набора данных в директории **root/.knowledgebase** создаётся папка с таким же именем._

## Настройка набора данных

На следующем скриншоте показана страница настройки набора данных. Правильная настройка набора данных критически важна для будущих AI-чатов. Например, выбор неправильной модели embedding (встраивания) или метода chunking (разбиения на части) может привести к неожиданной потере семантики или несоответствующим ответам в чатах.

![dataset configuration](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/configure_knowledge_base.jpg)

В этом разделе рассматриваются следующие темы:

- Выбор метода chunking
- Выбор модели embedding
- Загрузка файла
- Парсинг файла
- Вмешательство в результаты парсинга файла
- Запуск тестирования retrieval (извлечения)

### Выбор метода chunking

RAGFlow предлагает несколько встроенных шаблонов chunking для удобного разбиения файлов с разной структурой и обеспечения семантической целостности. В выпадающем списке **Built-in** метода chunking под пунктом **Parse type** вы можете выбрать шаблон по умолчанию, подходящий для структуры и формата ваших файлов. В следующей таблице приведены описания и совместимые форматы файлов для каждого поддерживаемого шаблона chunking:

| **Шаблон**   | Описание                                                             | Формат файла                                                                                  |
|--------------|----------------------------------------------------------------------|----------------------------------------------------------------------------------------------|
| General      | Файлы последовательно разбиваются на части по заданному числу токенов. | MD, MDX, DOCX, XLSX, XLS (Excel 97-2003), PPT, PDF, TXT, JPEG, JPG, PNG, TIF, GIF, CSV, JSON, EML, HTML |
| Q&A          |                                                                      | XLSX, XLS (Excel 97-2003), CSV/TXT                                                           |
| Resume       | Только для Enterprise edition. Также можно опробовать на demo.ragflow.io. | DOCX, PDF, TXT                                                                               |
| Manual       |                                                                      | PDF                                                                                          |
| Table        |                                                                      | XLSX, XLS (Excel 97-2003), CSV/TXT                                                           |
| Paper        |                                                                      | PDF                                                                                          |
| Book         |                                                                      | DOCX, PDF, TXT                                                                              |
| Laws         |                                                                      | DOCX, PDF, TXT                                                                              |
| Presentation |                                                                      | PDF, PPTX                                                                                   |
| Picture      |                                                                      | JPEG, JPG, PNG, TIF, GIF                                                                    |
| One          | Каждый документ разбивается целиком (как один блок).                | DOCX, XLSX, XLS (Excel 97-2003), PDF, TXT                                                    |
| Tag          | Набор данных функционирует как набор тегов для других.              | XLSX, CSV/TXT                                                                               |

Вы также можете изменить метод chunking для файла на странице **Files**.

![change chunking method](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/change_chunking_method.jpg)

<details>
  <summary>Начиная с версии v0.21.1, RAGFlow поддерживает ingestion pipeline (конвейер загрузки) для кастомизированных рабочих процессов загрузки и очистки данных.</summary>
   
  Для использования кастомного конвейера загрузки данных:

  1. На странице **Agent** нажмите **+ Create agent** > **Create from blank**.
  2. Выберите **Ingestion pipeline** и задайте имя вашему конвейеру в появившемся окне, затем нажмите **Save** для отображения холста конвейера.
  3. После обновления конвейера нажмите **Save** в правом верхнем углу холста.
  4. Перейдите на страницу **Configuration** вашего набора данных, выберите **Choose pipeline** в разделе **Ingestion pipeline**.
     
     *Ваш сохранённый конвейер появится в выпадающем списке ниже.*

</details>

### Выбор модели embedding

Модель embedding преобразует чанки в embeddings (векторы встраивания). Её нельзя изменить после того, как в наборе данных появились чанки. Чтобы переключиться на другую модель embedding, необходимо удалить все существующие чанки в наборе данных. Очевидная причина — мы *должны* гарантировать, что файлы в конкретном наборе данных преобразованы в embeddings с использованием *одной и той же* модели embedding (чтобы обеспечить сравнение в одном и том же пространстве embedding).

Следующие модели embedding могут быть развернуты локально:

- BAAI/bge-large-zh-v1.5
- maidalun1020/bce-embedding-base_v1

:::danger ВАЖНО
Эти две модели embedding оптимизированы специально для английского и китайского языков, поэтому производительность может снизиться при использовании для документов на других языках.
:::

### Загрузка файла

- В RAGFlow **File Management (Управление файлами)** позволяет связать один файл с несколькими наборами данных, при этом каждый целевой набор данных содержит ссылку на файл.
- В **Knowledge Base (База знаний)** также доступна опция загрузки одного файла или папки с файлами (массовая загрузка) с вашего локального компьютера в набор данных, при этом набор данных содержит копии файлов.

Хотя загрузка файлов напрямую в набор данных кажется более удобной, мы *настоятельно* рекомендуем загружать файлы в **File Management**, а затем связывать их с целевыми наборами данных. Таким образом вы избежите безвозвратного удаления файлов, загруженных в набор данных.

### Парсинг файла

Парсинг файла — ключевой этап настройки набора данных. В RAGFlow парсинг файла означает два процесса: разбиение файла на чанки на основе структуры файла и построение индексов embedding и полнотекстового поиска (по ключевым словам) на этих чанках. После выбора метода chunking и модели embedding вы можете начать парсинг файла:

![parse file](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/parse_file.jpg)

- Как показано выше, RAGFlow позволяет использовать для конкретного файла другой метод chunking, обеспечивая гибкость помимо метода по умолчанию.
- Как показано выше, RAGFlow позволяет включать или отключать отдельные файлы, обеспечивая более тонкий контроль над AI-чатами на основе набора данных.

### Вмешательство в результаты парсинга файла

RAGFlow обеспечивает видимость и объяснимость, позволяя просматривать результаты chunking и при необходимости вмешиваться. Для этого:

1. Нажмите на файл, для которого завершён парсинг, чтобы просмотреть результаты chunking:

   _Вы попадёте на страницу **Chunk**:_

   ![chunks](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/file_chunks.jpg)

2. Наведите курсор на каждый снимок для быстрого просмотра соответствующего чанка.

3. Дважды кликните по текстам чанков, чтобы добавить ключевые слова, вопросы, теги или внести *ручные* изменения при необходимости:

   ![update chunk](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/add_keyword_question.jpg)

:::caution ПРИМЕЧАНИЕ
Вы можете добавить ключевые слова к чанку файла, чтобы повысить его рейтинг для запросов, содержащих эти ключевые слова. Это действие увеличивает вес ключевых слов и может улучшить позицию чанка в списке поиска.
:::

4. В разделе Retrieval testing (Тестирование извлечения) задайте быстрый вопрос в поле **Test text**, чтобы проверить, работают ли ваши настройки:

   _Как видно ниже, RAGFlow отвечает с достоверными цитатами._

   ![retrieval test](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/retrieval_test.jpg)

### Запуск тестирования retrieval

RAGFlow использует множественный recall как полнотекстового поиска, так и векторного поиска в своих чатах. Перед настройкой AI-чата рекомендуется отрегулировать следующие параметры, чтобы гарантировать, что нужная информация всегда появляется в ответах:

- Порог сходства (Similarity threshold): чанки с похожестью ниже порога будут отфильтрованы. По умолчанию установлен на 0.2.
- Вес векторного сходства (Vector similarity weight): процент вклада векторного сходства в общий балл. По умолчанию установлен на 0.3.

Подробности смотрите в разделе [Run retrieval test](./run_retrieval_test.md).

## Поиск набора данных

Начиная с версии RAGFlow v0.21.1, функция поиска находится в зачаточном состоянии и поддерживает только поиск набора данных по имени.

![search dataset](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/search_datasets.jpg)

## Удаление набора данных

Вы можете удалить набор данных. Наведите курсор мыши на три точки на карточке нужного набора данных, и появится опция **Delete**. После удаления набора данных соответствующая папка в директории **root/.knowledge** УДАЛЯЕТСЯ АВТОМАТИЧЕСКИ. Последствия:

- Файлы, загруженные напрямую в набор данных, удаляются;  
- Ссылки на файлы, созданные из **File Management**, удаляются, но сами файлы остаются в **File Management**.

![delete dataset](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/delete_datasets.jpg)