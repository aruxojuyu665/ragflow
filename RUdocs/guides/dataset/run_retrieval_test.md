---
sidebar_position: 10
slug: /run_retrieval_test
---

# Запуск теста извлечения

Проведите тест извлечения на вашем наборе данных, чтобы проверить, могут ли быть найдены необходимые чанки (фрагменты).

---

После загрузки и парсинга файлов рекомендуется выполнить тест извлечения перед настройкой чат-ассистента. Запуск теста извлечения вовсе *не* является лишним или избыточным шагом! Подобно тонкой настройке прецизионного инструмента, RAGFlow требует тщательной настройки для обеспечения оптимальной производительности при ответах на вопросы. Настройки вашего набора данных, конфигурации чат-ассистента и выбранные большие и малые модели могут существенно влиять на конечные результаты. Запуск теста извлечения проверяет, могут ли быть найдены нужные чанки, что позволяет быстро выявить области для улучшения или определить проблему, требующую решения. Например, при отладке системы ответов на вопросы, если известно, что правильные чанки извлекаются, можно сосредоточить усилия на других аспектах. В случае с проблемой [#5627](https://github.com/infiniflow/ragflow/issues/5627) выяснилось, что причина была связана с ограничениями LLM.

Во время теста извлечения чанки, созданные с помощью указанного метода разбиения (chunking), извлекаются с использованием гибридного поиска. Этот поиск сочетает взвешенное сходство по ключевым словам с либо взвешенным косинусным сходством векторов, либо взвешенным reranking-скором, в зависимости от ваших настроек:

- Если rerank модель не выбрана, взвешенное сходство по ключевым словам комбинируется с взвешенным косинусным сходством векторов.
- Если rerank модель выбрана, взвешенное сходство по ключевым словам комбинируется с взвешенным reranking-скором.

В отличие от этого, чанки, созданные с помощью [конструирования knowledge graph (графа знаний)](./construct_knowledge_graph.md), извлекаются исключительно с использованием косинусного сходства векторов.

## Предварительные требования

- Ваши файлы загружены и успешно распарсены перед запуском теста извлечения.
- Граф знаний должен быть успешно построен перед включением опции **Use knowledge graph**.

## Конфигурации

### Порог сходства (Similarity threshold)

Устанавливает порог для извлечения чанков: чанки с показателями сходства ниже порога будут отфильтрованы. По умолчанию порог установлен на 0.2. Это означает, что будут извлекаться только чанки с гибридным баллом сходства 20 и выше.

### Вес векторного сходства (Vector similarity weight)

Задает вес векторного сходства в составном балле сходства, независимо от того, используется ли косинусное сходство векторов или reranking-скор. По умолчанию установлен на 0.3, что делает вес другого компонента равным 0.7 (1 - 0.3).

### Модель rerank (Rerank model)

- Если оставить пустым, RAGFlow будет использовать комбинацию взвешенного сходства по ключевым словам и взвешенного косинусного сходства векторов.
- Если выбрана rerank модель, взвешенное сходство по ключевым словам будет комбинироваться с взвешенным reranking-скором.

:::danger IMPORTANT
Использование rerank модели значительно увеличит время получения ответа.
:::

### Использовать граф знаний (Use knowledge graph)

В графе знаний описание сущности, описание отношения или отчет сообщества существуют как независимые чанки. Этот переключатель указывает, следует ли добавлять эти чанки в процесс извлечения.

Переключатель по умолчанию отключен. При включении RAGFlow выполняет следующее во время теста извлечения:

1. Извлекает сущности и типы сущностей из вашего запроса с помощью LLM.
2. Извлекает топ N сущностей из графа на основе их значений PageRank, используя извлечённые типы сущностей.
3. Находит похожие сущности и их N-ступенчатые связи в графе, используя эмбеддинги извлечённых сущностей запроса.
4. Извлекает похожие отношения из графа, используя эмбеддинг запроса.
5. Ранжирует извлечённые сущности и отношения, умножая значение PageRank каждой на её балл сходства с запросом, возвращая топ n как итоговое извлечение.
6. Извлекает отчет для сообщества, включающего наибольшее количество сущностей из итогового извлечения.  
   *Извлечённые описания сущностей, описания отношений и топ-1 отчет сообщества отправляются в LLM для генерации контента.*

:::danger IMPORTANT
Использование графа знаний в тесте извлечения значительно увеличит время получения ответа.
:::

### Кросс-языковой поиск (Cross-language search)

Для выполнения [кросс-языкового поиска](../../references/glossary.mdx#cross-language-search) выберите один или несколько целевых языков из выпадающего меню. Стандартная модель чата системы затем переведет ваш запрос, введённый в поле Test text, на выбранные целевые языки. Этот перевод обеспечивает точное семантическое сопоставление между языками, позволяя получать релевантные результаты независимо от языковых различий.

:::tip NOTE
- При выборе целевых языков убедитесь, что эти языки присутствуют в наборе данных для обеспечения эффективного поиска.
- Если целевой язык не выбран, система будет искать только на языке вашего запроса, что может привести к пропуску релевантной информации на других языках.
:::

### Тестовый текст (Test text)

Поле для ввода вашего тестового запроса.

## Процедура

1. Перейдите на страницу **Retrieval testing** вашего набора данных, введите запрос в поле **Test text** и нажмите **Testing** для запуска теста.
2. Если результаты неудовлетворительны, настройте параметры, перечисленные в разделе Конфигурации, и запустите тест повторно.

   *Ниже приведён скриншот теста извлечения, выполненного без использования графа знаний. Он демонстрирует гибридный поиск, сочетающий взвешенное сходство по ключевым словам и взвешенное косинусное сходство векторов. Общий гибридный балл сходства равен 28.56, рассчитанный как 25.17 (балл сходства по термам) x 0.7 + 36.49 (балл векторного сходства) x 0.3:*  
   ![Изображение](https://github.com/user-attachments/assets/541554d4-3f3e-44e1-954b-0ae77d7372c6)

   *Ниже приведён скриншот теста извлечения, выполненного с использованием графа знаний. Показано, что для чанков, созданных графом знаний, используется только векторное сходство:*  
   ![Изображение](https://github.com/user-attachments/assets/30a03091-0f7b-4058-901a-f4dc5ca5aa6b)

:::caution WARNING
Если вы изменили настройки по умолчанию, такие как вес сходства по ключевым словам или порог сходства, чтобы добиться оптимальных результатов, учтите, что эти изменения не сохранятся автоматически. Их необходимо применить в настройках вашего чат-ассистента или в настройках компонента агента **Retrieval**.
:::

## Часто задаваемые вопросы

### Используется ли LLM при включении переключателя Use Knowledge Graph?

Да, ваш LLM будет задействован для анализа вашего запроса и извлечения связанных сущностей и отношений из графа знаний. Это также объясняет, почему потребляется дополнительное количество токенов и времени.